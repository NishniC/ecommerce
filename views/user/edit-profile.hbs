<style>
    body {
        margin-top: 20px;
        color: #1a202c;
        text-align: left;
        background-color: #e2e8f0;
    }

    .main-body {
        padding: 15px;
    }

    .card {
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .1), 0 1px 2px 0 rgba(0, 0, 0, .06);
        position: relative;
        display: flex;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        border: 0 solid rgba(0, 0, 0, .125);
        border-radius: .25rem;
    }

    .card-body {
        flex: 1 1 auto;
        min-height: 1px;
        padding: 1rem;
    }

    .gutters-sm {
        margin-right: -8px;
        margin-left: -8px;
    }

    .gutters-sm>.col,
    .gutters-sm>[class*=col-] {
        padding-right: 8px;
        padding-left: 8px;
    }

    .mb-3,
    .my-3 {
        margin-bottom: 1rem!important;
    }

    .bg-gray-300 {
        background-color: #e2e8f0;
    }

    .h-100 {
        height: 100%!important;
    }

    .shadow-none {
        box-shadow: none!important;
    }

    /* Style for list items (buttons) */
    .list-group-item {
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .list-group-item:hover,
    .list-group-item.active {
        background-color: #e0e0e0;
    }

    /* Remove default list styling */
    .list-group-item {
        border: none;
        border-radius: 0;
    }

      label {
        margin-bottom: 0.5rem;
        display: block;
    }
</style>




<div class="container">
    <div class="main-body">
        <div class="row gutters-sm">
            <div class="col-md-4 mb-3">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex flex-column align-items-center text-center">
                            <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt="Admin" class="rounded-circle" width="150">
                            <div class="mt-3">
                                <h5>Hello, </h5>
                                <h4>{{user.firstName}} {{user.lastName}}</h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mt-3">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap" id="accountOverview">
                            <h6 type="btn"><a href="/user/user-profile" style="text-decoration: none;">Account Overview</a></h6>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap" id="myOrders">
                            <h6 type="btn">My Orders</h6>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap" id="myWishList">
                            <h6 type="btn">My Wish List</h6>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap" id="manageAddress">
                            <h6 type="btn">Manage address</h6>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-8">
                <!-- Edit Name Form -->
                <div class="card mb-3">
                    <div class="card-body">
                        <form id="profilename-edit" action="/user/edit-userName/{{user._id}}" method="Post">
                            <div class="row mb-4">
                                <h4>Edit Your Name</h4>
                                <div class="col-md-6">
                                    <label for="formFirstName">First Name</label>
                                    <div class="form-outline">
                                        <input type="text" id="formFirstName" name="firstName" class="form-control form-control-lg" value="{{user.firstName}}" style="border-color: #b382f5;" />
                                        <div class="firstName error" style="color: red;"></div>                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="formLastName">Last Name</label>
                                    <div class="form-outline">
                                        <input type="text" id="formLastName" name="lastName" class="form-control form-control-lg" value="{{user.lastName}}" style="border-color: #b382f5;" />
                                        <div class="lastName error" style="color: red;"></div>
                                    </div>
                                </div>
                            </div>
                            <div id="successMessage"></div>

                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-lg" style="background-color: #b382f5;">Edit</button>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- Edit Email Form -->
                <div class="card mb-3">
                    <div class="card-body">
                        <form id="profileemail-edit" action="/user/edit-email/{{user._id}}" method="Post">
                            <div class="row mb-4">
                                <h4>Edit Your Email</h4>
                                <div class="col-md-6">
                                    <label for="formEmail">Email</label>
                                    <div class="form-outline">
                                        <input type="text" id="formEmail" name="email" class="form-control form-control-lg" value="{{user.email}}" style="border-color: #b382f5;" />
                                        <div class="email error" style="color: red;"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-lg" style="background-color: #b382f5;">Edit</button>
                            </div>
                            </form>

                    </div>
                </div>
                <!-- Edit Password Form -->
                <div class="card mb-3">
                    <div class="card-body">
                        <form id="profilepassword-edit" action="/user/edit-password/{{user._id}}" method="Post">
                            
                                <h4>Edit Your Password</h4>
                                <div class="col-md-6">
                                    <label for="formpreviouspassword">Previous Password</label>
                                    <div class="form-outline">
                                        <input type="password" id="formpreviouspassword" name="formpreviouspassword" class="form-control form-control-lg"  style="border-color: #b382f5;" />
                                        <div class="formpreviouspassword error" style="color: red;"></div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label for="formnewpassword">New Password</label>
                                    <div class="form-outline">
                                        <input type="password" id="formnewpassword" name="formnewpassword" class="form-control form-control-lg" style="border-color: #b382f5;" />
                                        <div class="formnewpassword error" style="color: red;"></div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <label for="formconfirmpassword">Confirm Password</label>
                                    <div class="form-outline">
                                        <input type="password" id="formconfirmpassword" name="formconfirmpassword" class="form-control form-control-lg" style="border-color: #b382f5;" />
                                        <div class="formconfirmpassword error" style="color: red;"></div>
                                    </div>
                                </div>


                            
                            <div class="d-flex justify-content-end">
                                <button type="submit" class="btn btn-lg" style="background-color: #b382f5;">Edit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<script>
    const currentPage = "accountOverview";
    document.getElementById(currentPage).style.backgroundColor = "#BB84E8";

    document.addEventListener('DOMContentLoaded', (event) => {
        const formname = document.getElementById('profilename-edit');
        const formmail = document.getElementById('profileemail-edit');
        const formpassword = document.getElementById('profilepassword-edit');

        formname.addEventListener('submit', async (e) => {
            e.preventDefault();

            try {
                const formData = new FormData(formname);
                const formDataObject = {};
                formData.forEach((value, key) => {
                    formDataObject[key] = value;
                });

                const headers = {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                };

                const res = await fetch("/user/edit-userName/{{user._id}}", {
                    method: "POST",
                    body: JSON.stringify(formDataObject),
                    headers: headers,
                });

                const data = await res.json();

                if (data.error) {
                    document.querySelector('.firstName.error').textContent = data.error.firstName || '';
                    document.querySelector('.lastName.error').textContent = data.error.lastName || '';
                }

                if (data.newName) {
                    document.querySelector('.firstName.error').textContent = '';
                    document.querySelector('.lastName.error').textContent = '';
                    successMessage.textContent = 'Successfully changed name';
                    successMessage.style.color = 'green';
                    successMessage.style.textAlign = 'center';
                }

            } catch (err) {
                console.log(err);
            }
        });

        formmail.addEventListener('submit', async (e) => {
            e.preventDefault();

            try {
                const formData = new FormData(formmail);
                const formDataObject = {};
                formData.forEach((value, key) => {
                    formDataObject[key] = value;
                });

                const headers = {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                };
                console.log(formDataObject)
                const res = await fetch("/user/edit-email/{{user._id}}", {
                    method: "POST",
                    body: JSON.stringify(formDataObject),
                    headers: headers,
                });

                const data = await res.json();
                console.log(data)
                if (data.newEmail) {
                    const jsonData = encodeURIComponent(JSON.stringify(data));
                    location.assign(`/user/updatedotp-page?jsonData=${jsonData}`);
                 }                
                if(data.error){
                    document.querySelector('.email.error').textContent = data.error.email ||data.error || '';

                }

            } catch (err) {
                console.log(err);
            }
        });

        formpassword.addEventListener('submit', async (e) => {
            e.preventDefault();

            try {
                const formData = new FormData(formpassword);
                const formDataObject = {};
                formData.forEach((value, key) => {
                    formDataObject[key] = value;
                });

                const headers = {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                };

                const res = await fetch("/user/edit-password/{{user._id}}", {
                    method: "POST",
                    body: JSON.stringify(formDataObject),
                    headers: headers,
                });

                const data = await res.json();
                console.log(data)

                if (data.error) {
                document.querySelector('.formpreviouspassword.error').textContent = data.error.oldPassword || '';
                document.querySelector('.formnewpassword.error').textContent = data.error.password || '';
                document.querySelector('.formconfirmpassword.error').textContent = data.error.notequalpassword || data.error.confirmpassword || '';

                }

                if (data.newPassword) {
                    location.assign('/user/forlogout');
                }

            } catch (err) {
                console.log(err);
            }
        });
    });
</script>
